/* Twitch Filtered Chat Main Module */"use strict";/* TODO:
 * Add to #settings help link
 * Create page for the #settings config link
 * Finish badge information on hover
 * Finish clip information
 * Add emote information on hover
 * Allow plugins to define custom filtering
 * Create a README.md file for the plugins directory
 * Hide getConfigObject() within client_main()
 * Auto-complete commands (wip), command arguments, and @user names
 *//* IDEAS:
 * Add layout selection box to #settings (reloads page on change)?
 * Allow for a configurable number of columns?
 * Add re-include (post-exclude) filtering options for Mods, Bits, Subs, etc?
 *//* NOTES:
 * Filter function returning true -> message is hidden
 * Filtering JOIN and PART messages
 *   Util.Logger.add_filter(/^ws recv.*\b(JOIN|PART)\b/)
 * Filtering PRIVMSG messages
 *   Util.Logger.add_filter(/^ws recv.*\bPRIVMSG\b/)
 */var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var CFGKEY_DEFAULT="tfc-config",GITHUB_URL="https://kaedenn.github.io/twitch-filtered-chat/index.html",CURR_URL=function(a){return a.protocol+"//"+a.hostname+a.pathname}(window.location),Content=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"addHTML",/* exported Content */value:function m(a){var b=Math.pow,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=c?$(c):$(".module .content"),f=$(a);if(d){var g=!0,h=!1,i=void 0;try{for(var j,k,l=d[Symbol.iterator]();!(g=(j=l.next()).done);g=!0)k=j.value,k(f)}catch(a){h=!0,i=a}finally{try{!g&&l.return&&l.return()}finally{if(h)throw i}}}e.append($("<div class=\"line line-wrapper\"></div>").append(f)),e.attr("data-no-scroll")||e.scrollTop(b(2,31)-1)}},{key:"addPre",value:function c(b){a.addHTML($("<div class=\"pre\"></div>").html(b))}},{key:"addInfo",value:function e(b){var c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],d=$("<div class=\"info\"></div>").html(b);/* does not escape */c&&d.addClass("pre"),a.addHTML(d)}},{key:"addNotice",value:function e(b){var c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],d=$("<div class=\"notice\"></div>").html(b);/* does not escape */c&&d.addClass("pre"),a.addHTML(d)}},{key:"addError",value:function e(b){var c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],d=$("<div class=\"error\"></div>").html(b);/* does not escape */c&&d.addClass("pre"),a.addHTML(d)}},{key:"addHelp",value:function c(b){a.addPre($("<div class=\"help pre\">"+b+"</div>"))}},{key:"addHelpLine",value:function d(b,c){a.addPre(ChatCommands.helpLine(b,c))}}]),a}();/* Document writing functions {{{0 *//* End document writing functions 0}}} *//* Begin configuration section {{{0 *//* Merge the query string into the config object given and return removals */function parseQueryString(a){var b=Math.clamp,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=void 0,e=null===c?window.location.search:c;"string"==typeof e?d=Util.ParseQueryString(e):"object"===("undefined"==typeof e?"undefined":_typeof(e))?d=e:Util.Error("Refusing to parse strange query string object",e),d.hasOwnProperty("debug")||(d.debug=!1),"string"!=typeof d.channels&&(d.channels="");var f=[],g=!0,h=!1,i=void 0;try{for(var j,l=Object.entries(d)[Symbol.iterator]();!(g=(j=l.next()).done);g=!0){var m=j.value,n=_slicedToArray(m,2),o=n[0],k=n[1],p=o,q=k;/* config key *//* config val */if("clientid"===o)p="ClientID",a.__clientid_override=!0,f.push(o);else if("user"===o||"name"===o||"nick"===o)p="Name";else if("pass"===o)p="Pass",f.push(o);else if("channel"===o||"channels"===o)p="Channels",q=k.split(",").map(function(a){return Twitch.FormatChannel(a)});else if("debug"===o)p="Debug",q="debug"===k?Util.LEVEL_DEBUG:"trace"===k?Util.LEVEL_TRACE:"number"==typeof k?b(k,Util.LEVEL_MIN,Util.LEVEL_MAX):+!!k;else if("noassets"===o)p="NoAssets",q=!!k;else if("noffz"===o)p="NoFFZ",q=!!k;else if("nobttv"===o)p="NoBTTV",q=!!k;else if("hmax"===o)p="HistorySize",q="inf"===k?1/0:"number"==typeof k?k:TwitchClient.DEFAULT_HISTORY_SIZE;else if(o.match(/^module[\d]*?$/))p="module"===o?"module1":o,q=parseModuleConfig(k);else if("trans"===o||"transparent"===o)p="Transparent",q=1;else if("layout"===o)p="Layout",q=ParseLayout(k);else if("reconnect"===o)p="AutoReconnect",q=!0;else if("size"===o)p="Size",q=k+"pt";else if("plugins"===o)p="Plugins",q=!!k;else if("disable"===o)p="DisableEffects",q=k.split(",");else if("enable"===o)p="EnableEffects",q=k.split(",");else if("max"===o)p="MaxMessages",q="inf"===k||-1===k?1/0:"number"==typeof k?k:TwitchClient.DEFAULT_MAX_MESSAGES;else if("font"===o)p="Font",q=""+k;else if("scroll"===o)p="Scroll",q=!!k;else if("clips"===o)p="ShowClips",q=!!k;else if("plugincfg"===o){p="PluginConfig";try{q=JSON.parse(k)}catch(a){Util.Error(a),p=q=null}}/* Skip items with a falsy key */p&&(a[p]=q)}/* Ensure there's a layout property present */}catch(a){h=!0,i=a}finally{try{!g&&l.return&&l.return()}finally{if(h)throw i}}return a.hasOwnProperty("Layout")||(a.Layout=ParseLayout("double:chat")),f}/* Obtain configuration key */function getConfigKey(){var a=CFGKEY_DEFAULT,b=Util.ParseQueryString(),c=b.config_key||b.key||b["config-key"];return c&&(a=a+"-"+c.replace(/[^a-z]/g,"")),a}/* Obtain configuration */function getConfigObject(){function a(a){return Util.IsArray(a)?a:[]}/* Populate configs from each module */var b=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],c=null,d=null,f=Util.ParseQueryString();/* 1) Obtain configuration values
   *  a) from localStorage
   *  b) from query string (overrides (a))
   *  c) from settings elements (overrides (b))
   *  d) from liveStorage (module settings only, overrides (c))
   * 2) Store module configuration in each modules' settings window
   * 3) Remove sensitive values from the query string, if present
   *//* Query String object, parsed */f.nols?(Util.DisableLocalStorage(),d={}):(c=getConfigKey(),Util.SetWebStorageKey(c),c!==CFGKEY_DEFAULT&&Util.LogOnlyOnce("Using custom config key \""+Util.GetWebStorageKey()+"\""),d=Util.GetWebStorage()||{},d.key=c);/* Items to remove from the query string */var g=[];/* Certain unwanted items may be preserved in localStorage */d.hasOwnProperty("NoAssets")&&delete d.NoAssets,d.hasOwnProperty("Debug")&&delete d.Debug,d.hasOwnProperty("AutoReconnect")&&delete d.AutoReconnect,d.hasOwnProperty("Layout")&&delete d.Layout,d.hasOwnProperty("Plugins")&&delete d.Plugins,d.hasOwnProperty("nols")&&delete d.nols,d.hasOwnProperty("EnableEffects")&&delete d.EnableEffects,d.hasOwnProperty("DisableEffects")&&delete d.DisableEffects,d.hasOwnProperty("PluginConfig")&&delete d.PluginConfig,d.hasOwnProperty("MaxMessages")||(d.MaxMessages=TwitchClient.DEFAULT_MAX_MESSAGES),d.hasOwnProperty("Channels")&&Util.IsArray(d.Channels)||(d.Channels=[]),"string"!=typeof d.Name&&(d.Name=""),"string"!=typeof d.ClientID&&(d.ClientID=""),"string"!=typeof d.Pass&&(d.Pass=""),g=parseQueryString(d,f);/* Parse div#settings config */var h=$("input#txtChannel")[0],i=$("input#txtNick")[0],j=$("input#txtPass")[0];if(h.value){var k=!0,l=!1,m=void 0;try{for(var n,o=h.value.split(",")[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){var p=n.value,q=Twitch.FormatChannel(p.toLowerCase());-1===d.Channels.indexOf(q)&&d.Channels.push(q)}}catch(a){l=!0,m=a}finally{try{!k&&o.return&&o.return()}finally{if(l)throw m}}}/* See if there's anything we need to remove */if(i.value&&i.value!==Strings.AUTOGEN&&(d.Name=i.value),j.value&&j.value!==Strings.CACHED&&(d.Pass=j.value),"boolean"!=typeof d.Scroll&&(d.Scroll=$("#cbScroll").is(":checked")),"boolean"!=typeof d.ShowClips&&(d.ShowClips=$("#cbClips").is(":checked")),$(".module").each(function(){var b=$(this).attr("id");/* Populate module configuration from liveStorage (if present) */if(d[b]||(d[b]=getModuleSettings($(this))),window.liveStorage&&window.liveStorage[b]){var c=!0,e=!1,f=void 0;try{for(var g,h=Object.entries(window.liveStorage[b])[Symbol.iterator]();!(c=(g=h.next()).done);c=!0){var i=g.value,j=_slicedToArray(i,2),l=j[0],k=j[1];d[b][l]=k}}catch(a){e=!0,f=a}finally{try{!c&&h.return&&h.return()}finally{if(e)throw f}}}d[b].Pleb=!!d[b].Pleb,d[b].Sub=!!d[b].Sub,d[b].VIP=!!d[b].VIP,d[b].Mod=!!d[b].Mod,d[b].Event=!!d[b].Event,d[b].Bits=!!d[b].Bits,d[b].Me=!!d[b].Me,d[b].IncludeKeyword=a(d[b].IncludeKeyword),d[b].IncludeUser=a(d[b].IncludeUser),d[b].ExcludeUser=a(d[b].ExcludeUser),d[b].ExcludeStartsWith=a(d[b].ExcludeStartsWith),d[b].FromChannel=a(d[b].FromChannel)}),0<g.length){Util.SetWebStorage(d);var r=window.location.search,s=Util.ParseQueryString(r.substr(1)),t=!1;s.base64&&0<s.base64.length&&(t=!0,s=Util.ParseQueryString(atob(s.base64)));var u=!0,v=!1,w=void 0;try{for(var x,y,z=g[Symbol.iterator]();!(u=(x=z.next()).done);u=!0)y=x.value,delete s[y]}catch(a){v=!0,w=a}finally{try{!u&&z.return&&z.return()}finally{if(v)throw w}}var A=Util.FormatQueryString(s);t&&(A="?base64="+encodeURIComponent(btoa(A))),window.location.search=A}/* Default ClientID */return d.ClientID=[19,86,67,115,22,38,198,3,55,118,67,35,150,230,71,134,83,3,119,166,86,39,38,167,135,134,147,214,38,55].map(function(a){return Util.ASCII[16*(15&a)+(240&a)/16]}).join(""),b||(delete d.ClientID,delete d.Pass),d}/* Store configuration */function mergeConfigObject(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,b=a||{},c=getConfigObject();if(Util.IsArray(b)){var d=!0,e=!1,f=void 0;try{for(var g,h=b[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=_slicedToArray(i,2),l=j[0],k=j[1];c[l]=k}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}}else{var m=!0,n=!1,o=void 0;try{for(var p,q=Object.entries(b)[Symbol.iterator]();!(m=(p=q.next()).done);m=!0){var r=p.value,s=_slicedToArray(r,2),t=s[0],u=s[1];c[t]=u}}catch(a){n=!0,o=a}finally{try{!m&&q.return&&q.return()}finally{if(n)throw o}}}Util.SetWebStorage(c),window.liveStorage=c}/* Module configuration {{{1 *//* Enumerate the active modules */function getModules(){var a={},b=!0,c=!1,d=void 0;try{for(var e,f,g=$(".module")[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,a[$(f).attr("id")]=f}catch(a){c=!0,d=a}finally{try{!b&&g.return&&g.return()}finally{if(c)throw d}}return a}/* Apply configuration to the module's settings HTML */function setModuleSettings(a,b){function c(b){$(a).find(b).attr("checked","checked")}function d(b){$(a).find(b).removeAttr("checked")}function e(b,c,d){if(d&&0<d.length){var e=!0,f=!1,g=void 0;try{for(var h,i=d[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value,k=$("<li></li>");if(0===$(a).find("input."+b+"[value=\""+j+"\"]").length){var l=$("<label></label>").val(c),m=$("<input type=\"checkbox\" checked />");m.addClass(b),m.attr("value",j),m.click(updateModuleConfig),l.append(m),l.html(l.html()+c+j.escape()),k.append(l),$(a).find("li."+b).before(k)}}}catch(a){f=!0,g=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw g}}}}b.Name&&($(a).find("label.name").html(b.Name),$(a).find("input.name").val(b.Name)),b.Pleb?c("input.pleb"):d("input.pleb"),b.Sub?c("input.sub"):d("input.sub"),b.VIP?c("input.vip"):d("input.vip"),b.Mod?c("input.mod"):d("input.mod"),b.Event?c("input.event"):d("input.event"),b.Bits?c("input.bits"):d("input.bits"),b.Me?c("input.me"):d("input.me"),e("include_user",Strings.CFG_FROM,b.IncludeUser),e("include_keyword",Strings.CFG_CONTAINS,b.IncludeKeyword),e("exclude_user",Strings.CFG_FROM,b.ExcludeUser),e("exclude_startswith",Strings.CFG_STARTS,b.ExcludeStartsWith),e("from_channel",Strings.CFG_CHANNEL,b.FromChannel)}/* Obtain the settings from the module's settings HTML */function getModuleSettings(a){var b=$(a),c={Name:b.find("input.name").val(),Pleb:b.find("input.pleb").is(":checked"),Sub:b.find("input.sub").is(":checked"),VIP:b.find("input.vip").is(":checked"),Mod:b.find("input.mod").is(":checked"),Event:b.find("input.event").is(":checked"),Bits:b.find("input.bits").is(":checked"),Me:b.find("input.me").is(":checked"),IncludeUser:[],IncludeKeyword:[],ExcludeUser:[],ExcludeStartsWith:[],FromChannel:[]};return b.find("input.include_user:checked").each(function(){c.IncludeUser.push($(this).val())}),b.find("input.include_keyword:checked").each(function(){c.IncludeKeyword.push($(this).val())}),b.find("input.exclude_user:checked").each(function(){c.ExcludeUser.push($(this).val())}),b.find("input.exclude_startswith:checked").each(function(){c.ExcludeStartsWith.push($(this).val())}),b.find("input.from_channel:checked").each(function(){c.FromChannel.push($(this).val())}),c}/* Parse a module configuration object from a query string component */function parseModuleConfig(a){for(var b=function(a){return a.map(function(a){return decodeURIComponent(a)})},c=b(a.split(/,/g));7>c.length;)c.push("");/* Upgrade configuration from 6x to 7x */"111111"===c[1]&&(c[1]="1111111");var d=Util.DecodeFlags(c[1],7),e={};return e.Name=c[0],e.Pleb=d[0],e.Sub=d[1],e.VIP=d[2],e.Mod=d[3],e.Event=d[4],e.Bits=d[5],e.Me=d[6],e.IncludeKeyword=c[2]?b(c[2].split(/,/g)):[],e.IncludeUser=c[3]?b(c[3].split(/,/g)):[],e.ExcludeUser=c[4]?b(c[4].split(/,/g)):[],e.ExcludeStartsWith=c[5]?b(c[5].split(/,/g)):[],e.FromChannel=c[6]?b(c[6].split(/,/g)):[],e}/* Format the module configuration object into a query string component */function formatModuleConfig(a){var b=function(a){return a.map(function(a){return encodeURIComponent(a)})},c=[a.Pleb,a.Sub,a.VIP,a.Mod,a.Event,a.Bits,a.Me],d=[a.Name,Util.EncodeFlags(c,!1),b(a.IncludeKeyword).join(","),b(a.IncludeUser).join(","),b(a.ExcludeUser).join(","),b(a.ExcludeStartsWith).join(","),b(a.FromChannel).join(",")];return b(d).join(",")}/* Store the modules' settings in both localStorage and liveStorage */function updateModuleConfig(){var a={};$(".module").each(function(){var b=$(this).attr("id");a[b]=getModuleSettings($(this)),window.liveStorage||(window.liveStorage={}),window.liveStorage[b]=a[b]}),mergeConfigObject(a)}/* End module configuration 1}}} *//* Set the joined channels to the list given */function setChannels(a,b){var c=function(a){return Twitch.FormatChannel(Twitch.ParseChannel(a))},d=b.map(c),e=a.GetJoinedChannels().map(c),f=d.filter(function(a){return-1===e.indexOf(a)}),g=e.filter(function(a){return-1===d.indexOf(a)}),h=!0,i=!1,j=void 0;/* Join all the channels added */try{for(var k,l,m=f[Symbol.iterator]();!(h=(k=m.next()).done);h=!0)l=k.value,a.JoinChannel(l),Content.addNotice("Joining "+l);/* Leave all the channels removed */}catch(a){i=!0,j=a}finally{try{!h&&m.return&&m.return()}finally{if(i)throw j}}var n=!0,o=!1,p=void 0;try{for(var q,r,s=g[Symbol.iterator]();!(n=(q=s.next()).done);n=!0)r=q.value,a.LeaveChannel(r),Content.addNotice("Leaving "+r)}catch(a){o=!0,p=a}finally{try{!n&&s.return&&s.return()}finally{if(o)throw p}}}/* End configuration section 0}}} *//* Return whether or not the event should be filtered */function shouldFilter(a,b){var d=Plugins.invoke("shouldFilter",a,b),e=getModuleSettings(a);if(d&&0<d.length){var f=!0,g=!1,h=void 0;try{for(var j,k,l=d[Symbol.iterator]();!(f=(j=l.next()).done);f=!0){if(k=j.value,!0===k)return!0;if(!1===k)return!1}}catch(a){g=!0,h=a}finally{try{!f&&l.return&&l.return()}finally{if(g)throw h}}}if(b instanceof TwitchChatEvent){var m=b.user?b.user.toLowerCase():"",n=b.message?b.message.toLowerCase():"",o="pleb";/* NOTE: pleb < sub < vip < mod *//* Includes take priority over excludes */if(b.issub&&(o="sub"),b.isvip&&(o="vip"),b.ismod&&(o="mod"),e.IncludeUser.any(function(a){return a.toLowerCase()===m}))return!1;if(e.IncludeKeyword.any(function(a){return-1<n.indexOf(a)}))return!1;/* Role filtering */if(!e.Pleb&&"pleb"==o)return!0;if(!e.Sub&&"sub"==o)return!0;if(!e.VIP&&"vip"==o)return!0;if(!e.Mod&&"mod"==o)return!0;/* Content filtering ("Bits" also filters out cheer effects) */if(!e.Bits&&b.flags.bits)return!0;if(!e.Me&&b.flags.action)return!0;/* Exclude filtering */if(e.ExcludeUser.any(function(a){return a.toLowerCase()===m}))return!0;if(e.ExcludeStartsWith.any(function(a){return n.startsWith(a)}))return!0;/* Filtering to permitted channels (default: permit all) */if(0<e.FromChannel.length){var p=!0,q=!1,r=void 0;try{for(var t,u=e.FromChannel[Symbol.iterator]();!(p=(t=u.next()).done);p=!0){var v=t.value,s=-1===v.indexOf("#")?"#"+v:v;if(b.channel&&b.channel.channel&&b.channel.channel.toLowerCase()!==s.toLowerCase())return!0}}catch(a){q=!0,r=a}finally{try{!p&&u.return&&u.return()}finally{if(q)throw r}}}}else if(b instanceof TwitchEvent&&!e.Event)/* Filter out events and notices */{if("USERNOTICE"===b.command)return!0;if("NOTICE"===b.command)return!0}return!1}/* Populate and show the username context window */function showContextWindow(a,b,c){var e=Math.round,f=Number.parseInt;/* Define functions for building elements */function d(a){var b=$("<div class=\"item\"></div>");return"string"==typeof a?b.html(a):b.append(a),b}var g=$(b),i=$(c);$(b).html("");/* Clear everything from the last time *//* Attributes of the host line */var j=i.attr("data-id"),k=i.attr("data-user"),m=i.find(".username").text(),n=i.attr("data-user-id"),o="#"+i.attr("data-channel"),p=i.attr("data-channelid"),q="1"===i.attr("data-subscriber"),r="1"===i.attr("data-mod"),s="1"===i.attr("data-vip"),u="1"===i.attr("data-caster"),v=f(i.attr("data-sent-ts")),x=new Date(v);g.attr("data-id",j),g.attr("data-user",k),g.attr("data-user-id",n),g.attr("data-channel",o),g.attr("data-chid",p),g.attr("data-sub",q),g.attr("data-mod",r),g.attr("data-vip",s),g.attr("data-caster",u),g.attr("data-id",j);var y=function(b,c){return a.get("HTMLGen").url(null,c,"cw-link",b)},z=function(a){return $("<span class=\"em pad\">"+a+"</span>")},A=i.find(".username"),B=A.attr("class").escape(),C=A.attr("style").escape();/* Add user's display name *//* Add link to timeout user */if(g.append(d("<span class=\""+B+"\" style=\""+C+"\">"+m+"</span>"+" in <span class=\"em\">"+o+"</span>")),a.IsMod(o)){var D=$("<div class=\"cw-timeout\">Timeout:</div>"),E=!0,F=!1,G=void 0;try{for(var H,I=["1s","10s","60s","10m","30m","1h","12h","24h"][Symbol.iterator]();!(E=(H=I.next()).done);E=!0){var J=H.value,K=y("cw-timeout-"+k+"-"+J,J);K.addClass("cw-timeout-dur"),K.attr("data-channel",o),K.attr("data-user",k),K.attr("data-duration",J),K.click(function(){var c=$(this).attr("data-channel"),e=$(this).attr("data-user"),f=$(this).attr("data-duration");a.Timeout(c,e,f),Util.Log("Timed out user",e,"from",c,"for",f),$(b).fadeOut()}),D.append(K)}}catch(a){F=!0,G=a}finally{try{!E&&I.return&&I.return()}finally{if(F)throw G}}g.append(D)}/* Add link which places "/ban <user>" into the chat textbox */if(a.IsMod(o)){var X=y("cw-ban-"+k,"Ban");X.attr("data-channel",o),X.attr("data-user",k),X.click(function(){$("#txtChat").val("/ban "+$(this).attr("data-user"))}),g.append(X)}/* Add other information */var L=Util.FormatDate(x),M=Util.FormatInterval((Date.now()-v)/1e3);/* Add roles (and ability to remove roles, for the caster) */if(g.append(d("Sent: "+L+" ("+M+" ago)")),g.append(d("UserID: "+n)),g.append(d("MsgUID: "+j)),r||s||q||u){var N=d("User Role: "),O=[];if(r&&O.push(z("Mod")),s&&O.push(z("VIP")),q&&O.push(z("Sub")),u&&O.push(z("Host")),0<O.length){N.append(O[0]);var P=!0,Q=!1,R=void 0;try{for(var S,T,U=O.slice(1)[Symbol.iterator]();!(P=(S=U.next()).done);P=!0)T=S.value,N.append(", "),N.append(T)}catch(a){Q=!0,R=a}finally{try{!P&&U.return&&U.return()}finally{if(Q)throw R}}g.append(N)}a.IsCaster(o)&&!a.IsUIDSelf(n)&&(r&&g.append(d(y("cw-unmod","Remove Mod"))),s&&g.append(d(y("cw-unvip","Remove VIP"))))}/* Add the ability to add roles (for the caster) */a.IsCaster(o)&&!a.IsUIDSelf(n)&&(!r&&g.append(d(y("cw-make-mod","Make Mod"))),!s&&g.append(d(y("cw-make-vip","Make VIP"))));var V=i.offset(),W=e(V.top)+i.outerHeight()+2,t=e(V.left),l=g.outerWidth(),w=g.outerHeight(),h={top:W,left:t,width:l,height:w};Util.ClampToScreen(h),delete h.width,delete h.height,g.fadeIn().offset(h)}/* Set or unset transparency */function updateTransparency(a){var b=[];try{var c=Util.CSS.GetSheet("main.css"),d=Util.CSS.GetRule(c,":root"),e=!0,f=!1,g=void 0;/* Find the prop="--<name>-color" rules */try{for(var h,i,j=Util.CSS.GetPropertyNames(d)[Symbol.iterator]();!(e=(h=j.next()).done);e=!0)i=h.value,i.match(/^--[a-z-]+-color$/)&&b.push(i)}catch(a){f=!0,g=a}finally{try{!e&&j.return&&j.return()}finally{if(f)throw g}}}catch(a){/* Unable to enumerate properties; use hard-coded ones */Util.ErrorOnce("Failed getting main.css :root",a),b=["--body-color","--header-color","--menudiv-color","--module-color","--odd-line-color","--sub-color","--chat-color","--textarea-color"]}var k=!0,l=!1,m=void 0;try{for(var n,o,p=b[Symbol.iterator]();!(k=(n=p.next()).done);k=!0)o=n.value,a?(Util.CSS.SetProperty(o,"transparent"),$(".module").addClass("transparent"),$("body").addClass("transparent")):(Util.CSS.SetProperty(o,"var("+o+"-default)"),$(".module").removeClass("transparent"),$("body").removeClass("transparent"))}catch(a){l=!0,m=a}finally{try{!k&&p.return&&p.return()}finally{if(l)throw m}}}/* Set or clear window notification badge */function setNotify(){var a=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],b=a?AssetPaths.FAVICON_ALERT:AssetPaths.FAVICON;/* exported setNotify */$("link[rel=\"shortcut icon\"]").attr("href",b)}/* Called once when the document loads */function client_main(a){var g=Number.isNaN,h=Number.parseInt,j=Math.clamp;/* Call to sync configuration to HTMLGen */function b(){var a=Util.JSONClone(getConfigObject());delete a.Pass,delete a.ClientID,a.Plugins=!!a.Plugins;var b=!0,c=!1,d=void 0;try{for(var e,f=Object.entries(a)[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value,h=_slicedToArray(g,2),i=h[0],j=h[1];m.get("HTMLGen").setValue(i,j)}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}/* Construct the plugins *//* Close the main settings window */function c(){updateModuleConfig(),$("#settings").fadeOut()}/* Open the main settings window */function d(){var a=getConfigObject();$("#txtChannel").val(a.Channels.join(",")),$("#txtNick").val(a.Name||Strings.AUTOGEN),a.Pass&&0<a.Pass.length&&($("#txtPass").attr("disabled","disabled").hide(),$("#txtPassDummy").show()),$("#selDebug").val(""+a.Debug),$("#settings").fadeIn()}/* Toggle the main settings window */function f(){$("#settings").is(":visible")?c():d()}/* Bind DOM events {{{0 *//* ScrollLock: pause or resume auto-scroll *//* exported client_main */var m=void 0,n={};/* Hook Logger messages *//* Disable configured events */if(Util.Logger.add_hook(function(){for(var a,b=arguments.length,c=Array(2<b?b-2:0),d=2;d<b;d++)c[d-2]=arguments[d];var e=(a=Util.Logger).stringify.apply(a,c);Util.DebugLevel>=Util.LEVEL_DEBUG&&Content.addError("ERROR: "+e.escape())},"ERROR"),Util.Logger.add_hook(function(){for(var a,b=arguments.length,c=Array(2<b?b-2:0),d=2;d<b;d++)c[d-2]=arguments[d];var e=(a=Util.Logger).stringify.apply(a,c);1===c.length&&c[0]instanceof TwitchEvent?Util.DebugLevel>=Util.LEVEL_TRACE&&Content.addNotice("WARNING: "+JSON.stringify(c[0])):Util.DebugLevel>=Util.LEVEL_DEBUG&&Content.addNotice("WARNING: "+e.escape())},"WARN"),Util.Logger.add_hook(function(){for(var a,b=arguments.length,c=Array(2<b?b-2:0),d=2;d<b;d++)c[d-2]=arguments[d];var e=(a=Util.Logger).stringify.apply(a,c);Util.DebugLevel>=Util.LEVEL_TRACE&&Content.addHTML("DEBUG: "+e.escape())},"DEBUG"),Util.Logger.add_hook(function(){for(var a,b=arguments.length,c=Array(2<b?b-2:0),d=2;d<b;d++)c[d-2]=arguments[d];var e=(a=Util.Logger).stringify.apply(a,c);Util.DebugLevel>=Util.LEVEL_TRACE&&Content.addHTML("TRACE: "+e.escape())},"TRACE"),function(){var a=getConfigObject();m=new TwitchClient(a),Util.DebugLevel=a.Debug,document.title+=" -",a.Pass&&0<a.Pass.length?document.title+=" Authenticated":(document.title+=" Read-Only",a.Layout.Chat&&($("#txtChat").attr("placeholder",Strings.PLEASE_AUTH),Util.CSS.SetProperty("--chat-border","#cd143c"))),$(".module").each(function(){setModuleSettings(this,a[$(this).attr("id")])}),ChatCommands.add("config",function(a,b){var c=Number.parseFloat,d=getConfigObject(),e=0<b.length?b[0]:"";if(0===b.length){var ba=[];Content.addHelp("<em>Global Configuration Values:</em>");var f=!0,i=!1,j=void 0;try{for(var l,n=Object.entries(d)[Symbol.iterator]();!(f=(l=n.next()).done);f=!0){var o=l.value,p=_slicedToArray(o,2),q=p[0],k=p[1],r=q,s=""+k;"Layout"===q?s=FormatLayout(k):"ClientID"===q?s=Strings.OMIT_CID:"Pass"===q?s=Strings.OMIT_PASS:"object"===("undefined"==typeof k?"undefined":_typeof(k))&&k.Name&&0<k.Name.length&&(r=null,s=null,ba.push([q,k])),null!==r&&Content.addHelpLine(r,s)}}catch(a){i=!0,j=a}finally{try{!f&&n.return&&n.return()}finally{if(i)throw j}}Content.addHelp("<em>Window Configuration Values:</em>");var t=!0,u=!1,v=void 0;try{for(var w,x=ba[Symbol.iterator]();!(t=(w=x.next()).done);t=!0){var y=w.value,z=_slicedToArray(y,2),A=z[0],B=z[1],C=function(a){return"&quot;"+a+"&quot"};Content.addHelp("Module <span class=\"arg\">"+A+"</span>: "+C(B.Name));var D=!0,E=!1,F=void 0;try{for(var G,H=Object.entries(B)[Symbol.iterator]();!(D=(G=H.next()).done);D=!0){var I=G.value,J=_slicedToArray(I,2),K=J[0],L=J[1];"Name"!==K&&Content.addHelpLine(K,C(L))}}catch(a){E=!0,F=a}finally{try{!D&&H.return&&H.return()}finally{if(E)throw F}}}}catch(a){u=!0,v=a}finally{try{!t&&x.return&&x.return()}finally{if(u)throw v}}}else if("help"===e)Content.addHelpLine("//config","Show global and module configurations"),Content.addHelp("//config parameters:"),Content.addHelpLine("purge","Clear local storage (cannot be undone!)"),Content.addHelpLine("clientid","Displays ClientID"),Content.addHelpLine("pass","Displays OAuth token (if specified)"),Content.addHelpLine("url","Generate a URL from the current config"),Content.addHelp("//config url parameters (can be used in any order):"),Content.addHelpLine("git","Generate link using github.io"),Content.addHelpLine("text","Don't base64-encode the URL"),Content.addHelpLine("auth","Include ClientID and OAuth information"),Content.addHelp("//config set <key> <value>: change <key> to <value> (dangerous)".escape()),Content.addHelp("//config setobj <key> <value>: change <key> to JSON <value> (dangerous)".escape());else if("purge"===e)Util.SetWebStorage({}),window.liveStorage={},Content.addNotice("Purged storage \""+Util.GetWebStorageKey()+"\"");else if("clientid"===e)Content.addHelpLine("ClientID",d.ClientID);else if("pass"===e)Content.addHelpLine("Pass",d.Pass);else if("url"===e){/* Generate a URL with the current configuration, omitting items
           * left at default values *//* Base URL, query string array, and function to add items */var M=-1<b.indexOf("git")?GITHUB_URL:CURR_URL,N=[],O=function(a,b){return N.push(a+"="+encodeURIComponent(b))};0<d.Debug&&O("debug",d.Debug),d.__clientid_override&&O("clientid",d.ClientID),O("channels",d.Channels.join(",")),d.NoAssets&&O("noassets",d.NoAssets),d.NoFFZ&&O("noffz",d.NoFFZ),d.NoBTTV&&O("nobttv",d.NoBTTV),d.HistorySize&&O("hmax",d.HistorySize);var P=!0,Q=!1,R=void 0;try{for(var S,T,U=Object.keys(getModules())[Symbol.iterator]();!(P=(S=U.next()).done);P=!0)T=S.value,O(T,formatModuleConfig(d[T]))}catch(a){Q=!0,R=a}finally{try{!P&&U.return&&U.return()}finally{if(Q)throw R}}O("layout",FormatLayout(d.Layout)),d.Transparent&&O("trans","1"),d.AutoReconnect&&O("reconnect","1");var V=Util.CSS.GetProperty("--body-font-size"),W=Util.CSS.GetProperty("--body-font-size-default");V!==W&&O("size",V.replace(/[^0-9]/g,"")),d.Plugins&&O("plugins","1"),d.MaxMessages!==TwitchClient.DEFAULT_MAX_MESSAGES&&O("max",""+d.MaxMessages),d.Font&&O("font",d.Font),d.Scroll&&O("scroll","1"),d.ShowClips&&O("clips","1"),-1<b.indexOf("auth")&&(O("user",d.Name),O("pass",d.Pass)),d.DisableEffects&&O("disable",d.DisableEffects.join(",")),d.EnableEffects&&O("enable",d.EnableEffects.join(",")),d.PluginConfig&&O("plugincfg",JSON.stringify(d.PluginConfig)),M+="text"===b[b.length-1]?"?"+N.join("&"):"?base64="+encodeURIComponent(btoa(N.join("&"))),Content.addHelp(m.get("HTMLGen").url(M))}else if(("set"===e||"setobj"===e)&&2<b.length){/* Allow changing configuration by command (dangerous) */var ca=b[1];if(Util.ObjectHas(d,ca)){var X=b.slice(2).join(" "),Y=Util.ObjectGet(d,ca),Z=null;Z="setobj"===e?JSON.parse(X):"true"===X||"false"!==X&&(g(h(X))?g(c(X))?X:c(X):h(X));var _=JSON.stringify(Y),aa=JSON.stringify(Z);Util.Log("Changing "+ca+" from \""+_+"\" to \""+aa+"\""),Content.addHelpLine(ca,JSON.stringify(Y)),Content.addHelpLine(ca,JSON.stringify(Z)),Util.ObjectSet(d,ca,Z),mergeConfigObject(d)}else Content.addError("Config item "+ca.escape()+" does not exist")}else Util.ObjectHas(d,e)?Content.addHelpLine(e,JSON.stringify(Util.ObjectGet(d,e))):Content.addError("Unknown config command or key &quot;"+e.escape()+"&quot;",!0)},"Obtain and modify configuration information"),n=Util.JSONClone(a),delete n.Pass,delete n.ClientID,n.Plugins=!!a.Plugins,n.MaxMessages=a.MaxMessages?a.MaxMessages:TwitchClient.DEFAULT_MAX_MESSAGES}(),n.DisableEffects){var o=!0,p=!1,q=void 0;try{for(var r,s,t=n.EnableEffects[Symbol.iterator]();!(o=(r=t.next()).done);o=!0)s=r.value,CSSCheerStyles[s]&&(CSSCheerStyles[s]._disabled=!0)}catch(a){p=!0,q=a}finally{try{!o&&t.return&&t.return()}finally{if(p)throw q}}}/* Enable configured effects */if(n.EnableEffects){var u=!0,v=!1,w=void 0;try{for(var x,y,z=n.EnableEffects[Symbol.iterator]();!(u=(x=z.next()).done);u=!0)y=x.value,CSSCheerStyles[y]&&(CSSCheerStyles[y]._disabled=!1)}catch(a){v=!0,w=a}finally{try{!u&&z.return&&z.return()}finally{if(v)throw w}}}/* Simulate clicking cbTransparent if config.Transparent is set */n.Transparent&&updateTransparency(!0),n.Size&&Util.CSS.SetProperty("--body-font-size",n.Size),n.Font&&Util.CSS.SetProperty("--body-font",n.Font),n.Scroll?($(".module .content").css("overflow-y","scroll"),$("#cbScroll").attr("checked","checked")):$("#cbScroll").removeAttr("checked"),0===n.Channels.length&&$("#settings").fadeIn(),n.ShowClips?$("#cbClips").attr("checked","checked"):$("#cbClips").removeAttr("checked"),m.set("HTMLGen",new HTMLGenerator(m,n)),n.Plugins?Plugins.loadAll(m,n):Plugins.disable(),Util.DebugLevel>=Util.LEVEL_DEBUG&&(window.client=m),ChatCommands.addHelp(Strings.TFC_HEADER,{literal:!0}),ChatCommands.addHelp(Strings.TFC_RELOAD,{literal:!0,command:!0}),ChatCommands.addHelp(Strings.TFC_FRELOAD,{literal:!0,command:!0}),ChatCommands.addHelp(Strings.TFC_NUKE,{literal:!0,command:!0}),ChatCommands.addHelp(Strings.TFC_UNUKE,{command:!0}),$(document).keydown(function(a){if("ScrollLock"===a.key){var b=$(".module .content"),c=b.attr("data-no-scroll");c?(b.removeAttr("data-no-scroll"),Util.Log("Auto-scroll enabled"),Content.addHelp("Auto-scroll enabled")):(b.attr("data-no-scroll","1"),Util.Log("Auto-scroll disabled"),Content.addHelp("Auto-scroll disabled"))}}),$("#txtChat").keydown(function(a){var b=event.target;if("Enter"===a.key)return 0<b.value.trim().length&&(ChatCommands.isCommandStr(b.value)?ChatCommands.execute(b.value,m):m.SendMessageToAll(b.value),m.AddHistory(b.value),b.setAttribute("data-hist-index","-1"),b.setAttribute("data-complete-text",""),b.setAttribute("data-complete-pos","-1"),b.setAttribute("data-complete-index","0"),b.value=""),a.preventDefault(),!1;if("Tab"===a.key){/* FIXME: Doesn't quite work with "//<tab>"
       * TODO: Complete command arguments and @user names */var c=b.getAttribute("data-complete-text")||b.value,d=h(b.getAttribute("data-complete-pos")),e=h(b.getAttribute("data-complete-index"));(g(d)||-1===d)&&(d=b.selectionStart),g(e)&&(e=0);var l={orig_text:c,orig_pos:d,curr_text:b.value,curr_pos:b.selectionStart,index:e};return l=ChatCommands.complete(l),b.setAttribute("data-complete-text",l.orig_text),b.setAttribute("data-complete-pos",l.orig_pos),b.setAttribute("data-complete-index",l.index),b.value=l.curr_text,requestAnimationFrame(function(){b.selectionStart=l.curr_pos,b.selectionEnd=l.curr_pos}),a.preventDefault(),!1}if("ArrowUp"===a.key||"ArrowDown"===a.key){/* Handle traversing message history */var f=h($(b).attr("data-hist-index")),k=m.GetHistoryLength();f=j(f+("ArrowUp"===a.key?1:-1),-1,k-1),b.value=-1<f?m.GetHistoryItem(f).trim():"",b.setAttribute("data-hist-index",""+f),b.setAttribute("data-complete-text",""),b.setAttribute("data-complete-pos","-1"),b.setAttribute("data-complete-index","0"),requestAnimationFrame(function(){b.selectionStart=b.value.length,b.selectionEnd=b.value.length})}else b.setAttribute("data-complete-text",""),b.setAttribute("data-complete-pos","-1"),b.setAttribute("data-complete-index","0")}),$("#settings").keyup(function(a){"Enter"===a.key&&f()}),$("#btnSettings").click(function(){f()}),$("#btnSettingsHelp").click(function(){var a=Util.Open("assets/help-window.html","TFCHelpWindow",{menubar:"yes",location:"yes",resizable:"yes",scrollbars:"yes",status:"yes"});a&&(a.onload=function(){this.addEntry("Help text and settings builder are coming soon!"),this.setConfig(getConfigObject(!1))})}),$("#btnSettingsBuilder").click(function(){/* TODO: Make a separate page for the settings builder */var a=Util.Open("assets/help-window.html","TFCBuilderWindow",{menubar:"yes",location:"yes",resizable:"yes",scrollbars:"yes",status:"yes"});a&&(a.onload=function(){this.addEntry("Help text and settings builder are coming soon!"),this.setConfig(getConfigObject(!1))})}),$("#txtChannel").keyup(function(a){"Enter"===a.key&&(setChannels(m,$(this).val().split(",")),mergeConfigObject({Channels:m.GetJoinedChannels()}))}),$("#txtChannel").blur(function(){setChannels(m,$(this).val().split(",")),mergeConfigObject({Channels:m.GetJoinedChannels()})}),$("#txtBGStyle").keyup(function(a){"Enter"===a.key&&$(".module").css("background-image",$(this).val())}),$("#cbScroll").change(function(){var a=$(this).is(":checked");mergeConfigObject({Scroll:a}),$(".module .content").css("overflow-y",a?"scroll":"hidden")}),$("#cbTransparent").change(function(){var a=$(this).is(":checked");updateTransparency(a),b()}),$("#cbClips").change(function(){mergeConfigObject({ShowClips:$(this).is(":checked")}),b()}),$("#selDebug").change(function(){var a=parseInt($(this).val());Util.Log("Changing debug level from "+Util.DebugLevel+" to "+a),Util.DebugLevel=a}),$("#btnClose").click(function(){c()}),$("#btnReconnect").click(function(){m.Connect()}),$(".menu").click(function(){var a=$(this).parent().children(".settings"),b=$(this).parent().children("label.name"),c=$(this).parent().children("input.name");a.is(":visible")?(updateModuleConfig(),c.hide(),b.html(c.val()).show()):(b.hide(),c.val(b.html()).show()),a.fadeToggle()}),$(".module .header input.name").keyup(function(a){if("Enter"===a.key){var b=$(this).parent().children(".settings"),c=$(this).parent().children("label.name"),d=$(this).parent().children("input.name");d.hide(),c.html(d.val()).show(),b.fadeToggle(),updateModuleConfig()}}),$(".module .header .clear-link").click(function(){$(this).parentsUntil(".column").find(".line-wrapper").remove()}),$(".module .settings input[type=\"text\"]").keyup(function(a){var b=$(this).val();if(0<b.length&&"Enter"===a.key){var c=$(this).closest("li"),d=c.attr("class").replace("textbox","").trim(),e=m.get("HTMLGen").checkbox(b,null,d,!0),f=c.find("label").html(),g=$("<li><label>"+e+f+" "+b+"</label></li>");c.before(g),$(this).val(""),updateModuleConfig()}}),$(document).click(function(a){var b=$(a.target),c=$("#userContext"),d=!0,e=!1,f=void 0;/* Clicking off of module settings: hide it */try{for(var g,h=Object.values(getModules())[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=$(i);if(j.is(":visible")){var k=j.find(".settings"),l=j.find(".header");if(!Util.PointIsOn(a.clientX,a.clientY,k[0])&&!Util.PointIsOn(a.clientX,a.clientY,l[0])){updateModuleConfig();var q=k.siblings("input.name").hide();k.siblings("label.name").html(q.val()).show(),k.fadeOut()}}}/* Clicking on the username context window */}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}if(Util.PointIsOn(a.clientX,a.clientY,c[0])){var n=c.attr("data-channel"),o=c.attr("data-user"),p=c.attr("data-user-id");m.IsUIDSelf(p)||("cw-unmod"===b.attr("id")?(Util.Log("Unmodding",o,"in",n),m.SendMessage(n,"/unmod "+o)):"cw-unvip"===b.attr("id")?(Util.Log("Removing VIP for",o,"in",n),m.SendMessage(n,"/unvip "+o)):"cw-make-mod"===b.attr("id")?(Util.Log("Modding",o,"in",n),m.SendMessage(n,"/mod "+o)):"cw-make-vip"===b.attr("id")&&(Util.Log("VIPing",o,"in",n),m.SendMessage(n,"/vip "+o)))}else if("1"===b.attr("data-username")){/* Clicked on a username; show context window */var r=b.parent();c.is(":visible")&&c.attr("data-user-id")===r.attr("data-user-id")?c.fadeOut():showContextWindow(m,c,r)}else c.is(":visible")&&/* Clicked somewhere else: close context window */c.fadeOut();/* Clicking on a "Reconnect" link */"1"===b.attr("data-reconnect")&&(Content.addNotice(Strings.RECONNECTING),m.Connect())}),m.bind("twitch-open",function(){$(".loading").remove(),$("#debug").hide(),Util.DebugLevel>=Util.LEVEL_DEBUG&&Content.addInfo(m.IsAuthed()?Strings.AUTH:Strings.UNAUTH),0===getConfigObject().Channels.length&&Content.addInfo(Strings.PLEASE_JOIN)}),m.bind("twitch-close",function(a){var b=a.raw_line.code,c=a.raw_line.reason,d=c?"(code "+b+": "+c+")":"(code "+b+")";getConfigObject().AutoReconnect?(Content.addError(Strings.CONN_CLOSED+d),m.Connect()):Content.addError(Strings.CONN_CLOSED+d+Strings.RECONNECT)}),m.bind("twitch-reconnect",function(){m.Connect()}),m.bind("twitch-join",function(b){Util.Browser.IsOBS||a.Slim||b.user!==m.GetName().toLowerCase()||Content.addInfo("Joined "+b.channel.channel)}),m.bind("twitch-part",function(b){Util.Browser.IsOBS||a.Slim||b.user!==m.GetName().toLowerCase()||Content.addInfo("Left "+b.channel.channel)}),m.bind("twitch-notice",function(a){var b=Twitch.FormatChannel(a.channel),c=a.message.escape();Content.addNotice(b+": "+c),"cmds_available"===a.notice_msgid&&Content.addInfo(Strings.USE_HELP)}),m.bind("twitch-error",function(a){Util.Error(a);var b=a.user,c=a.values.command,d=a.message.escape();Content.addError("Error for "+b+": "+c+": "+d)}),m.bind("twitch-message",function(a){Util.DebugLevel>=Util.LEVEL_TRACE&&(a instanceof TwitchEvent?Content.addPre(a.repr()):Content.addPre(JSON.stringify(a)));/* Avoid flooding the DOM with stale chat messages */var b=getConfigObject().MaxMessages||TwitchClient.DEFAULT_MAX_MESSAGES,d=!0,e=!1,f=void 0;/* FIXME: Causes flickering for some reason */try{for(var g,h,i=$(".content")[Symbol.iterator]();!(d=(g=i.next()).done);d=!0)for(h=g.value;$(h).find(".line-wrapper").length>b;)$(h).find(".line-wrapper").first().remove()}catch(a){e=!0,f=a}finally{try{!d&&i.return&&i.return()}finally{if(e)throw f}}}),m.bind("twitch-streaminfo",function(a){var b=m.GetChannelInfo(a.channel.channel);n.Layout&&!n.Layout.Slim&&(b.online?Content.addNotice(Strings.Active(a.channel.channel)):Content.addNotice(Strings.InActive(a.channel.channel)))}),m.bind("twitch-chat",function(a){if(a instanceof TwitchChatEvent){var b="string"==typeof a.message?a.message:"";if(a.flags&&a.flags.mod&&-1<b.indexOf(" ")){var c=b.split(" ");if("!tfc"===c[0]){if("reload"===c[1])location.reload();else if("force-reload"===c[1])location.reload(!0);else if("clear"===c[1])$(".content").children().remove();else if("nuke"===c[1])if(c[2]&&1<c[2].length){var d=CSS.escape(c[2].toLowerCase());$("[data-user=\""+d+"\"]").parent().remove()}else $(".content").children().remove();return}}}$(".module").each(function(){var b=m.get("HTMLGen");if(!shouldFilter($(this),a)){var c=$(this).find(".content"),d=$("<div class=\"line line-wrapper\"></div>"),e=b.gen(a),f=e.find(".message[data-clip]");if(0<f.length){var g=f.attr("data-clip");m.GetClip(g).then(function(a){m.GetGame(a.game_id).then(function(d){Content.addHTML(b.genClip(g,a,d),c)})})}d.append(e),Content.addHTML(d,c)}})}),m.bind("twitch-clearchat",function(a){if(a.flags["target-user-id"]){/* Moderator timed out a user */var b=CSS.escape(a.flags["room-id"]),c=CSS.escape(a.flags["target-user-id"]),d=$(".chat-line[data-channel-id=\""+b+"\"][data-user-id=\""+c+"\"]");d.parent().remove()}else/* Moderator cleared the chat */$("div.content").find(".line-wrapper").remove()}),m.bind("twitch-clearmsg",function(a){Util.StorageAppend("debug-msg-log",a),Util.Warn("Unhandled CLEARMSG:",a)}),m.bind("twitch-sub",function(a){Util.StorageAppend("debug-msg-log",a),Content.addHTML(m.get("HTMLGen").sub(a))}),m.bind("twitch-resub",function(a){/* Display the resub message, if one is present */if(Util.StorageAppend("debug-msg-log",a),Content.addHTML(m.get("HTMLGen").resub(a)),a.message){var b=m.get("HTMLGen").gen(a);b.addClass("message"),b.addClass("sub-message"),b.addClass("sub-user-message"),b.addClass("rainbow").addClass("disco"),Content.addHTML(b)}}),m.bind("twitch-giftsub",function(a){Util.StorageAppend("debug-msg-log",a),Content.addHTML(m.get("HTMLGen").giftsub(a))}),m.bind("twitch-anongiftsub",function(a){Util.StorageAppend("debug-msg-log",a),Content.addHTML(m.get("HTMLGen").anongiftsub(a))}),m.bind("twitch-raid",function(a){Util.StorageAppend("debug-msg-log",a),Content.addHTML(m.get("HTMLGen").raid(a))}),m.bind("twitch-newuser",function(a){Util.StorageAppend("debug-msg-log",a)}),m.bind("twitch-otherusernotice",function(a){Util.StorageAppend("debug-msg-log",a)}/* TODO: submysterygift, rewardgift, giftpaidupgrade, anongiftpaidupgrade,
     * unraid, bitsbadgetier */),m.bind("twitch-hosttarget",function(a){Util.StorageAppend("debug-msg-log",a)}),m.bind("twitch-userstate",function(){}),m.bind("twitch-roomstate",function(){}),m.bind("twitch-globaluserstate",function(){}),m.bind("twitch-usernotice",function(){}),m.bind("twitch-ack",function(){}),m.bind("twitch-ping",function(){}),m.bind("twitch-names",function(){}),m.bind("twitch-topic",function(){}),m.bind("twitch-privmsg",function(){}),m.bind("twitch-whisper",function(){}),m.bind("twitch-mode",function(){}),m.bind("twitch-other",function(){}),m.bindDefault(function(a){Util.Warn("Unbound event:",a),Util.StorageAppend("debug-msg-log",a)}),m.Connect()}/* vim: set ts=2 sts=2 sw=2 et: */